# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:

- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом
- src/components/common - папка с общими классами
- src/components/services - папка с кодом для организации логики, связанной с API
- src/components/model - папка для моделей
- src/components/view - папка для отображений
- src/components/view/CardView - папка для различных отображений карточки товара
- src/components/view/OrderView - папка для отображений двух шагов ввода информации для заказа

Важные файлы:

- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/scss/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами


## Установка и запуск

Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```

## Сборка

```
npm run build
```

или

```
yarn build
```

## 1. Краткое описание проекта

"WEB Larek" - это веб-приложение для управления интернет-ларьком, предоставляющее пользователям возможность просмотра товаров, оформления заказов и управления корзиной. Проект реализован с использованием объектно-ориентированного подхода на TypeScript.

## 2. Используемый архитектурный паттерн

Приложение построено на основе MVP (Model-View-Presenter) и использует Event-Driven архитектуру для управления событиями. Данные представлены в виде моделей (Model), интерфейс реализован через слой представления (View), а управление взаимодействием осуществляется через Presenter.

## 3. Базовые классы и их предназначение

Базовые классы включают классы, которые можно переиспользовать в любом проекте без изменений. Они обеспечивают фундаментальную функциональность для остальных частей приложения.

### 3.1. Класс EventEmitter

Описание:
  Этот класс реализует брокер событий и позволяет подписываться на события, инициировать их и управлять подписками.

Методы:

  on<T extends object>(event: EventName, callback: (data: T) => void): void; — подписка на событие.

  emit<T extends object>(event: string, data?: T): void; — вызов обработчиков при возникновении события.

  trigger<T extends object>(event: string, context?: Partial<T>): (data: T) => void; - создаёт функцию-триггер, которая при вызове будет генерировать событие event и объединять данные data с context

  off(event: EventName, callback: Function): отписка от события

  onAll(callback: Function): подписка на все события

  offAll(): удаление всех обработчиков

### 3.2. Абстрактный класс Component<T>

Описание:
  Родительский класс для всех классов слоя VIEW. Предоставляет базовые методы работы с DOM.

Свойства:

  protected readonly container: HTMLElement - корневой DOM-элемент

Конструктор:

  protected constructor(protected readonly container: HTMLElement)

Методы:

  toggleClass(element: HTMLElement, className: string, force?: boolean): переключить класс

  protected setText(element: HTMLElement, value: unknown): установить текстовое содержимое

  setDisabled(element: HTMLElement, state: boolean): сменить статус блокировки

  protected setHidden(element: HTMLElement): скрыть элемент

  protected setVisible(element: HTMLElement): показать элемент

  protected setImage(element: HTMLImageElement, src: string, alt?: string): установить изображение

  render(data?: Partial<T>): HTMLElement: вернуть корневой DOM-элемент

 ### 3.3. Абстрактный класс Model<T>

Описание:
  Родительский класс для всех моделей данных. Обеспечивает управление состоянием и валидацию данных.

Свойства:

  protected events: IEvents - объект для работы с событиями

Конструктор:

  constructor(data: Partial<T>, protected events: IEvents): инициализирует модель на основе переданных данных

Методы:

  emitChanges(event: string, payload?: object): отправляет событие об изменении модели

### 3.4. класс Api

Описание:

  Api — это универсальный класс для выполнения HTTP-запросов к серверу. Предоставляет базовые методы GET, POST и обрабатывает ответы от сервера. Используется как основа для построения специфичных API-клиентов.

Свойства:
  baseUrl: string — базовый URL для всех запросов.

  options: RequestInit — конфигурация по умолчанию для всех fetch-запросов (например, заголовки).

Конструктор:
  constructor(baseUrl: string, options: RequestInit = {})  - При инициализации добавляется заголовок Content-Type: application/json ко всем запросам.

Методы:
  get(uri: string): Promise<object> - Выполняет GET-запрос по заданному uri.

  post(uri: string, data: object, method: ApiPostMethods = 'POST'): Promise<object> - Выполняет POST-, PUT- или DELETE-запрос на указанный uri с передачей data в теле запроса.

  protected handleResponse(response: Response): Promise<object> - Метод обрабатывает ответ от сервера. Если ответ успешный (status 2xx), возвращает JSON. В случае ошибки возвращает Promise.reject с текстом ошибки. Используется внутри get и post.

## 4. MODEL

Модели данных, наследуемые от Model<T>:

### 4.1 AppState - класс отвечающий за хранение, изменение и валидацию данных приложения
Описание:
  AppState — это центральное хранилище состояния приложения, основанное на модели Model<IAppState>. Управляет каталогом товаров, корзиной пользователя, контактной и платежной информацией, а также валидацией форм. Предназначен для синхронизации данных между представлением и логикой приложения.

Свойства:
  catalog: IProduct[] — список доступных товаров.

  preview: IProduct | null — текущий выбранный товар для предпросмотра.

  order: IOrder — объект текущего заказа, включая контактные данные, адрес, способ оплаты и список товаров.

  formErrors: FormError — объект с ошибками валидации форм (доставки и контактов).

Конструктор:
  constructor() - Конструктор не принимает аргументы и инициализирует состояние заказа и пустой каталог.

Методы:
  getCatalog(): IProduct[]
  Возвращает текущий каталог товаров.

  setCatalog(items: IProduct[]): void
  Устанавливает каталог товаров и оповещает подписчиков об изменениях (items:changed).

  setPreview(item: IProduct): void
  Устанавливает товар для предпросмотра и вызывает событие preview:changed.

  getPreview(): IProduct
  Возвращает текущий товар в предпросмотре.

  addToBasket(orderItem: IProduct): void
  Добавляет товар в корзину, если он там ещё не находится, и вызывает события items:changed и preview:changed.

  removeFromBasket(id: string): void
  Удаляет товар по id из корзины и вызывает события items:changed и basket:open.

  clearBasket(): void
  Очищает корзину и вызывает события items:changed и preview:changed.

  getBasketItems(): IProduct[]
  Возвращает список товаров в корзине.

  isInBasket(id: string): boolean
  Проверяет, находится ли товар с заданным id в корзине.

  getTotal(): number
  Возвращает количество товаров в корзине.

  getTotalAmount(): number
  Возвращает общую стоимость всех товаров в корзине.

  setPaymentMethod(method: string): void
  Устанавливает способ оплаты и запускает валидацию данных доставки.

  setOrderDeliveryField(value: string): void
  Устанавливает адрес доставки и запускает его валидацию.

  setOrderContactField(field: keyof IOrderStepTwo, value: string): void
  Устанавливает значение контактного поля (email или телефон) и запускает его валидацию.

  validateDelivery(): boolean
  Проверяет корректность заполнения адреса и способа оплаты. В случае ошибок — сохраняет их и эмиттирует deliveryFormError:change.

  validateContact(): boolean
  Проверяет email и телефон на корректность. При ошибках — сохраняет их и эмиттирует contactFormError:change.

  clearOrder(): void
  Полностью сбрасывает данные заказа, включая способ оплаты, контакты, адрес и корзину.

События:
  items:changed  - перерисовывает каталог
  preview:changed - перерисовывает предпросмотр товара
  basket:open - сигнализирует о открытие корзины
  contactFormError:change - сигнализирует о ошибках в контактах
  deliveryFormError:change - сигнализирует о ошибках в доставке

## 5. View

Классы слоя представления, наследуемые от Component<T>:

### 5.1 класс Card
Описание:
  Класс Card представляет карточку товара в интерфейсе. Он отвечает за отображение информации о продукте (название, изображение, категория, цена) и обработку пользовательских действий, таких как нажатие на кнопку. Расширяет базовый компонент Component<IProduct>.

Свойства:
  _title: HTMLElement — элемент, отображающий название продукта.

  _image: HTMLImageElement — элемент изображения товара.

  _category: HTMLElement — элемент, отображающий категорию товара.

  _button: HTMLButtonElement — кнопка карточки для взаимодействия.

  _price: HTMLElement — элемент, отображающий цену товара.

  categoryKey: Record<string, string> — соответствие категорий и CSS-модификаторов для стилизации.


Конструктор: 
  constructor(container: HTMLElement, actions?: IActions) - Инициализирует элементы карточки, настраивает обработчик события клика, если он передан в actions.

Методы:
  set title(value: string): void — устанавливает текст заголовка карточки.

  set category(value: string): void — задаёт категорию товара и применяет соответствующий CSS-класс.

  set image(value: string): void — устанавливает URL изображения товара.

  set price(value: number): void — устанавливает цену товара в формате "X синапсов".

  render(data: Partial<IProduct>): HTMLElement — принимает частичные данные товара и обновляет отображение карточки.

События:
  click — если задан обработчик onClick в actions, он навешивается на кнопку карточки или сам контейнер. Используется для обработки взаимодействия пользователя с карточкой.

### 5.2  класс CardPreview 
Описание:
  Класс CardPreview расширяет функциональность базовой карточки Card, добавляя описание товара, кнопку добавления и возможность управления доступностью этой кнопки в зависимости от условий (например, наличия цены). Используется для предварительного просмотра товара и добавления его в корзину или список.
Свойства:
  _addButton: HTMLButtonElement — кнопка добавления товара.

  _text: HTMLElement — элемент, отображающий описание товара (текст).

  Наследует свойства класса Card:

  _title, _image, _category, _button, _price, categoryKey.

Конструктор:
  constructor(container: HTMLElement, actions?: IActions) - Вызывает конструктор родительского класса Card, находит и сохраняет элементы описания и кнопки добавления. Если передан обработчик onClick, навешивает его на кнопку добавления.

Методы:
  priceDisabled(value: number | null): void — отключает кнопку добавления, если значение цены отсутствует (null или 0).

  set description(value: string): void — устанавливает текст описания товара.

  set added(value: boolean): void — отключает кнопку добавления, если товар уже добавлен.

События:
  click — если задан обработчик onClick в actions, он навешивается на кнопку добавления товара (.card__button).

### 5.3 класс CardOrderItem
Описание:
  CardOrderItem — класс, расширяющий функциональность базовой карточки Card для отображения товара в корзине. Добавляет возможность удалить товар и отобразить его порядковый номер (ID) в заказе. 

Свойства:

  _removeBtn: HTMLButtonElement — кнопка удаления товара из корзины.

  _basketId: HTMLElement — элемент, отображающий идентификатор позиции в заказе.

  Унаследованные свойства от Card: _title, _image, _category, _button, _price, categoryKey.

Конструктор:

  constructor(container: HTMLElement, actions?: IActions) - Вызывает конструктор Card. Инициализирует элементы удаления и идентификатора позиции в корзине. Если передан onClick, он навешивается на кнопку удаления товара.

Методы: 

  set itemId(id: string): void — устанавливает ID товара в корзине.

  get itemId(): string — возвращает ID, отображаемый в карточке.

События:

  click — при наличии onClick в actions, назначается на кнопку удаления .basket__item-delete.

### 5.4 класс OrderStepOne

Описание:

  OrderStepOne — класс, расширяющий универсальную форму Form<IOrderStepOne>. Используется для оформления первого шага заказа, где пользователь выбирает способ оплаты и вводит адрес доставки. Обрабатывает переключение метода оплаты и отслеживает ввод адреса.

Свойства:

  _paymentMethod: HTMLButtonElement[] — список кнопок выбора метода оплаты (.button_alt).

  _paymentContainer: HTMLDivElement — контейнер для кнопок методов оплаты (.order__buttons).

  _address: HTMLInputElement — поле ввода адреса доставки.
  
  Наследуемые свойства от Form<IOrderStepOne>: container, events, _submit, _errors.

Конструктор: 
  constructor(container: HTMLFormElement, events: IEvents) - Выполняет инициализацию элементов формы: контейнера с кнопками оплаты и поля адреса. Вешает обработчик нажатий на кнопки оплаты. 

Методы:
  setTogglePayment(className: string): void
  Переключает активную кнопку метода оплаты, добавляя/удаляя класс button_alt-active в зависимости от имени кнопки.

  set address(value: string): void
  Устанавливает значение адреса доставки в соответствующее поле ввода.

События:

  click на кнопке метода оплаты — вызывает order.payment:change с выбранным методом.

  Унаследованные события от Form:

  ${formName}.${field}:change при вводе данных.

  ${formName}:submit при отправке формы.


### 5.5 класс OrderStepTwo 
Описание:
  OrderStepTwo — класс, расширяющий форму Form<IOrderStepTwo>. Используется для второго шага оформления заказа, где пользователь вводит контактные данные: номер телефона и адрес электронной почты. Реализует установку значений этих полей и поддержку событий формы.

Свойства:

  _phone: HTMLInputElement — поле ввода номера телефона (name="phone").

  _email: HTMLInputElement — поле ввода email-адреса (name="email").

  Наследуемые свойства от Form<IOrderStepTwo>: container, events, _submit, _errors.

Конструктор:
  constructor(container: HTMLFormElement, events: IEvents)  -Инициализирует форму и находит механизм событий, реализованный в базовом классе Form.

Методы:

  set phone(value: string): void
  Устанавливает значение номера телефона в поле ввода.

  set email(value: string): void
  Устанавливает значение email в поле ввода.

События:

  input — вызывает ${formName}.phone:change и ${formName}.email:change при изменении соответствующих полей.

  submit — вызывает ${formName}:submit при отправке формы.


 ### 5.6 класс Basket

Описание: 
  Basket — класс, представляющий корзину покупок на сайте. Отображает список товаров в корзине, общую сумму и кнопку для перехода к оформлению заказа. Управляет отображением списка продуктов и общей суммой, а также активирует/деактивирует кнопку в зависимости от наличия товаров.

Свойства:

  _list: HTMLElement — элемент для отображения списка товаров в корзине (.basket__list).

  _total: HTMLElement — элемент для отображения общей суммы (.basket__price).

  _button: HTMLElement — кнопка для перехода к оформлению заказа (.basket__button).

  events: IEvents — объект для отправки событий.

  Наследуемые свойства от Component<IBasketView>: container.

Конструктор:
  constructor(container: HTMLElement, events: IEvents) - В конструкторе осуществляется инициализация элементов корзины

Методы:

  set productList(items: HTMLElement[]): void
  Устанавливает список товаров в корзине. Если товары есть, они отображаются, а кнопка для оформления заказа становится активной. Если корзина пуста, отображается сообщение "Корзина пуста", и кнопка блокируется.

  set totalAmount(total: number): void
  Устанавливает общую сумму заказа, добавляя текст "синапсов" к числовому значению.

  render(data: Partial<IBasketView>): HTMLElement
  Применяет данные для рендера корзины и возвращает контейнер.

События:

  click на кнопке оформления заказа — вызывает событие order:open.


### 5.7 класс Page
Описание:
  Page — класс, представляющий страницу с каталогом товаров и корзиной. Управляет отображением элементов каталога, количеством товаров в корзине и состоянием блокировки страницы. Интегрирован с событиями, связанными с взаимодействием с корзиной.

Свойства:

  _catalog: HTMLElement — элемент каталога товаров (.gallery).

  _basket: HTMLButtonElement — кнопка для перехода к корзине (.header__basket).

  _counter: HTMLElement — элемент для отображения количества товаров в корзине (.header__basket-counter).

  _wrapper: HTMLElement — обертка страницы, которая может быть заблокирована или разблокирована (.page__wrapper).

  events: IActions — объект для управления событиями на странице.

  Наследуемые свойства от Component<IPage>: container.

Конструктор:
  constructor(container: HTMLElement, events: IActions) - В конструкторе осуществляется инициализация элементов страницы (контейнер для каталога, корзины, счетчик и обертка страницы)

Методы:

  set catalog(items: HTMLElement[]): void
  Устанавливает элементы каталога товаров. Если передан список элементов, он заменяет текущие.

  set counter(addedItems: number): void
  Устанавливает количество товаров в корзине и отображает его в соответствующем элементе.

  set locked(value: boolean): void
  Блокирует или разблокирует страницу, добавляя или удаляя класс page__wrapper_locked.

События:

  click на кнопке корзины — вызывает переданный в events обработчик.

### 5.8 класс Success

 Описание:
  Класс Success отображает модальное окно успешного завершения заказа. Показывает сумму списанных синапсов и предоставляет пользователю возможность закрыть это окно.

Свойства:
  protected _close: HTMLElement
  Кнопка закрытия окна.

  protected _total: HTMLElement
  Элемент, в котором отображается сообщение с суммой списания.

Конструктор:
  constructor(container: HTMLElement, actions: IActions)
  Инициализирует компоненты интерфейса и вешает обработчик на кнопку закрытия, если он передан в actions.onClick.

Методы:
  set total(total: string): void
  Устанавливает текст в _total в формате: "Списано {total} синапсов".

События:
  onClick (передаётся через actions)
  Вызывается при клике на кнопку закрытия окна успешного заказа.
  Обычно используется для закрытия модального окна (например, modal.close()).


### 5.9 класс Form<T> - это View, специализированный компонент для ввода и отправки данных, не знающий о модели и логике приложения.

Описание:
  Универсальный класс формы Form<T>, основанный на Component<IFormState>. Поддерживает привязку к событиям ввода, валидации и отправки. Используется для создания форм с автоматическим управлением состоянием, обработкой ошибок и интеграцией с событийной системой IEvents.

Свойства:

  container: HTMLFormElement — HTML-форма, переданная в качестве контейнера.

  events: IEvents — объект событий, используемый для оповещения о действиях пользователя.

  _submit: HTMLButtonElement — кнопка отправки формы (button[type=submit]).

  _errors: HTMLElement — элемент отображения ошибок (.form__errors).

Конструктор: 
  constructor(container: HTMLFormElement, events: IEvents) - Инициализирует форму, настраивает прослушивание событий input и submit

Методы:

  protected onInputChange(field: keyof T, value: string): void
  Вызывает событие изменения конкретного поля формы в формате:
  ${formName}.${field}:change с данными { field, value }.

  set valid(value: boolean): void
  Включает или отключает кнопку отправки формы в зависимости от валидности.

  set errors(value: string): void
  Устанавливает сообщение об ошибке в блок .form__errors.

  render(state: Partial<T> & IFormState): HTMLElement
  Обновляет форму, применяя состояние валидации, ошибки и значения полей. Возвращает DOM-элемент формы.


События:

  input — вызывает событие изменения поля: ${formName}.${field}:change.

  submit — вызывает событие отправки формы: ${formName}:submit.

### 5.10 класс Modal

Описание:
  Modal — компонент, управляющий отображением модального окна. Обеспечивает открытие и закрытие модального окна, замену его содержимого, а также отправку событий открытия/закрытия. Наследуется от Component<IModalData>.

Свойства:

  _closeButton: HTMLButtonElement — кнопка закрытия модального окна (.modal__close).

  _content: HTMLElement — контейнер содержимого модального окна (.modal__content).

  events: IEvents — объект для отправки событий.

  Наследуемые свойства от Component<IModalData>: container.

Конструктор: constructor(container: HTMLElement, events: IEvents) - В конструкторе осуществляется инициализация элементов модального окна. 

Методы:

  set content(value: HTMLElement): void
  Заменяет содержимое модального окна на переданный DOM-элемент.

  open(): void
  Активирует модальное окно, добавляя CSS-класс 'modal_active', и отправляет событие modal:open.

  close(): void
  Скрывает модальное окно, удаляя класс 'modal_active', очищает содержимое и отправляет событие modal:close.

  render(data: IModalData): HTMLElement
  Вызывает базовый render, после чего открывает модальное окно с заданными данными.

События:

'modal:open' — при открытии модального окна.

'modal:close' — при его закрытии.

## 6 ApiClient
Описание:
  ApiClient — класс, реализующий клиент для работы с API. Он предоставляет методы для получения списка товаров и оформления заказов. Использует базовый класс Api для выполнения HTTP-запросов и добавляет функциональность для работы с изображениями через CDN.

Свойства:

  cdn: string — URL для доступа к ресурсам CDN (например, изображениям товаров).

  Наследуемые свойства от Api:

  baseUrl: string — базовый URL для API.

  options: RequestInit — опции для запросов.

Конструктор:

  constructor(cdn: string, baseUrl: string, options?: RequestInit) - В конструкторе инициализируется базовый класс Api, а также сохраняется URL для CDN, который используется для построения полных путей к изображениям товаров.

Методы:

  getProducts(): Promise<IProduct[]>
  Получает список товаров с сервера. Каждый товар будет дополнен полным путем к изображению, используя CDN.

  placeOrder(order: IOrderPost): Promise<OrderResponse>
  Отправляет запрос для оформления заказа и возвращает ответ с информацией о заказе.

События:
  Нет событий.

## 8 Список событий
Вот список всех возможных событий, которые используются в коде:

items:changed
Событие, которое вызывается при изменении каталога товаров.

card:selected
Событие, которое вызывается при выборе карточки товара.

product:add
Событие, которое вызывается при добавлении товара в корзину.

preview:changed
Событие, которое вызывается при изменении данных превью товара.

modal:open
Событие, которое вызывается для открытия модального окна.

modal:close
Событие, которое вызывается для закрытия модального окна.

basket:open
Событие, которое вызывается для открытия корзины.

item:remove
Событие, которое вызывается при удалении товара из корзины.

order:open
Событие, которое вызывается при открытии формы оформления заказа.

order.payment:change
Событие, которое вызывается при изменении метода оплаты.

order.address:change
Событие, которое вызывается при изменении поля адреса доставки.

deliveryFormError:change
Событие, которое вызывается при изменении состояния ошибок в форме доставки.

order:submit
Событие, которое вызывается при отправке формы с данными заказа.

contacts.*:change
Событие для изменения данных в полях контактов (с использованием регулярных выражений для отслеживания любых изменений в полях типа contacts.*).

contactFormError:change
Событие, которое вызывается при изменении состояния ошибок в форме контактов.

contacts:submit
Событие, которое вызывается при отправке формы с данными контактов.

## Presenter не вынесен в отдельный класс (логика будет реализована в index.ts)

## 9. Пример взаимодействия 
Пользотатель нажимает на кнопку товара чтобы посмотреть подробности  (Preview товара)
1. View реагирует на действие пользователя и генерирует событие (при помощи emit)

2. Presenter обрабатывает событие и вызывает метод модели (или API) (в моем случае в index.ts будет прописана конструкция типа: events.on<('card:selected', (item: IProduct)=>{
  appData.setPreview(item)
})>) 

3. Модель вызывает состояние setPreview и генерирует событие: this.emitChanges('preview:changed', item);

4. Presenter обрабатывает событие ('preview:changed') и вызывает рендер View (CardPreview)

